<!DOCTYPE html>
<html lang="pt-BR" xmlns:th="http://www.thymeleaf.org">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title th:text="${pageTitle}">Painel Administrativo - E-commerce Baltazar</title>

	<link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
	<link rel="stylesheet" th:href="@{/css/styles.css}">
	<link rel="stylesheet" th:href="@{/css/admin.css}">
	<link rel="stylesheet" th:href="@{/css/auth.css}">

	<style>
		/* Pequenos ajustes de espaçamento sem “quebrar” seu CSS */
		.admin-section { padding-bottom: 2rem; }
		.admin-divider { height: 1px; background: var(--border-color); margin: 1.5rem 0; opacity: .9; }
	</style>
</head>

<body>
	<!-- Admin Header -->
	<header class="admin-header">
		<div class="admin-nav-container">
			<div class="admin-logo">
				<a th:href="@{/}">
					<h1><i class="fas fa-shopping-bag"></i> <span th:text="${brandName}">E-commerce</span></h1>
				</a>
				<span class="admin-badge">Admin</span>
			</div>

			<div class="admin-user-actions">
				<button class="theme-toggle" id="theme-toggle" title="Alternar tema" type="button">
					<i class="fas fa-sun"></i>
				</button>

				<div class="admin-user-info">
					<i class="fas fa-user-shield"></i>
					<span th:text="${adminName}">Admin</span>
				</div>

				<a th:href="@{/}" class="btn btn-outline btn-small">
					<i class="fas fa-arrow-left"></i> Voltar ao Site
				</a>
			</div>
		</div>
	</header>

	<!-- Admin Layout -->
	<div class="admin-layout">

		<!-- Sidebar -->
		<aside class="admin-sidebar">
			<nav class="admin-nav">
				<ul class="admin-nav-list">
					<li class="admin-nav-item">
						<a href="#dashboard" class="admin-nav-link active" data-section="dashboard">
							<i class="fas fa-tachometer-alt"></i>
							<span>Dashboard</span>
						</a>
					</li>
					<li class="admin-nav-item">
						<a href="#produtos" class="admin-nav-link" data-section="products">
							<i class="fas fa-box"></i>
							<span>Produtos</span>
						</a>
					</li>
					<li class="admin-nav-item">
						<a href="#pedidos" class="admin-nav-link" data-section="orders">
							<i class="fas fa-shopping-cart"></i>
							<span>Pedidos</span>
						</a>
					</li>
					<li class="admin-nav-item">
						<a href="#usuarios" class="admin-nav-link" data-section="users">
							<i class="fas fa-users"></i>
							<span>Usuários</span>
						</a>
					</li>
				</ul>
			</nav>
		</aside>

		<!-- Main Content -->
		<main class="admin-main">

			<!-- Dashboard -->
			<section id="dashboard" class="admin-section active">
				<div class="admin-header-section">
					<h2><i class="fas fa-tachometer-alt"></i> Dashboard</h2>
					<p>Visão geral do sistema</p>
				</div>

				<div class="stats-grid">
					<div class="stat-card">
						<div class="stat-icon">
							<i class="fas fa-box text-primary"></i>
						</div>
						<div class="stat-content">
							<h3 th:text="${totalProducts}">0</h3>
							<p>Total de Produtos</p>
						</div>
					</div>

					<div class="stat-card">
						<div class="stat-icon">
							<i class="fas fa-users text-success"></i>
						</div>
						<div class="stat-content">
							<h3 th:text="${totalUsers}">0</h3>
							<p>Usuários Cadastrados</p>
						</div>
					</div>

					<div class="stat-card">
						<div class="stat-icon">
							<i class="fas fa-shopping-cart text-warning"></i>
						</div>
						<div class="stat-content">
							<h3 th:text="${totalOrders}">0</h3>
							<p>Pedidos Realizados</p>
						</div>
					</div>

					<div class="stat-card">
						<div class="stat-icon">
							<i class="fas fa-dollar-sign text-success"></i>
						</div>
						<div class="stat-content">
							<h3 th:text="'R$ ' + ${#numbers.formatDecimal(totalSales, 1, 'POINT', 2, 'COMMA')}">R$ 0,00</h3>
							<p>Total em Vendas</p>
						</div>
					</div>
				</div>

				<div class="admin-grid">
					<div class="admin-card">
						<div class="card-header">
							<h3>Pedidos Recentes</h3>
						</div>
						<div class="card-content">
							<p style="opacity:.8">Em breve: lista dinâmica de pedidos.</p>
						</div>
					</div>

					<div class="admin-card">
						<div class="card-header">
							<h3>Produtos Mais Vendidos</h3>
						</div>
						<div class="card-content">
							<p style="opacity:.8">Em breve: ranking dinâmico.</p>
						</div>
					</div>
				</div>
			</section>

			<!-- Produtos -->
			<section id="products" class="admin-section">
				<div class="admin-header-section">
					<h2><i class="fas fa-box"></i> Gestão de Produtos</h2>
					<a th:href="@{/admin}" class="btn btn-primary" id="add-produto-btn">
						<i class="fas fa-plus"></i> Adicionar Produto
					</a>
				</div>

				<!-- Form -->
				<form id="produto-form" class="form-grid two-columns" th:action="@{/admin}" method="POST">
					<input type="hidden" name="id" value="">

					<div class="form-group">
						<label for="produto-nome">Nome do Produto</label>
						<input type="text" id="produto-nome" name="name" required>
					</div>

					<div class="form-group">
						<label for="produto-categoria">Categoria</label>
						<select id="produto-categoria" name="category" required>
							<option value="">Selecione uma categoria</option>
							<option value="ELECTRONICS">Eletrônicos</option>
							<option value="CLOTHING">Roupas</option>
							<option value="HOME">Casa & Jardim</option>
							<option value="SPORTS">Esportes</option>
						</select>
					</div>

					<div class="form-group">
						<label for="produto-preco">Preço</label>
						<input type="number" id="produto-preco" name="price" step="0.01" value="0" required>
					</div>

					<div class="form-group">
						<label for="produto-estado">Estado</label>
						<select id="produto-estado" name="state" required>
							<option value="ACTIVE">Ativo</option>
							<option value="INACTIVE">Inativo</option>
						</select>
					</div>

					<div class="form-group full-width">
						<label for="produto-descricao">Descrição</label>
						<textarea id="produto-descricao" name="description" rows="4" required></textarea>
					</div>

					<div class="form-actions">
						<button type="button" class="btn btn-outline btn-form">
							<i class="fas fa-times"></i> Cancelar
						</button>
						<button type="submit" class="btn btn-primary btn-form">
							<i class="fas fa-save"></i> Salvar
						</button>
					</div>
				</form>

				<div class="admin-divider"></div>

				<!-- Filters -->
				<div class="admin-filters" id="produtos">
					<div class="filter-group">
						<input type="text" id="search-produtos" placeholder="Buscar produtos..." class="admin-input">

						<select id="filter-categoria" class="admin-select">
							<option value="" th:selected="${selectedCategory == ''}">Todas as categorias</option>
							<option value="ELECTRONICS" th:selected="${selectedCategory == 'ELECTRONICS'}">Eletrônicos</option>
							<option value="CLOTHING" th:selected="${selectedCategory == 'CLOTHING'}">Roupas</option>
							<option value="HOME" th:selected="${selectedCategory == 'HOME'}">Casa & Jardim</option>
							<option value="SPORTS" th:selected="${selectedCategory == 'SPORTS'}">Esportes</option>
						</select>
					</div>
				</div>

				<!-- Table -->
				<div class="admin-table-container">
					<table class="admin-table" id="produtos-table">
						<thead>
							<tr>
								<th>ID</th>
								<th>Nome</th>
								<th>Categoria</th>
								<th>Preço</th>
								<th>Estado</th>
								<th>Ações</th>
							</tr>
						</thead>

						<tbody>
							<tr th:each="p : ${products}"
								th:attr="data-category=${#strings.toUpperCase(#strings.trim(p.category))}">
								<td th:text="${p.id}">1</td>
								<td th:text="${p.name}">Produto</td>
								<td th:text="${p.category}">ELECTRONICS</td>
								<td th:text="'R$ ' + ${#numbers.formatDecimal(p.price, 1, 'POINT', 2, 'COMMA')}">R$ 0,00</td>
								<td th:text="${p.state}">ACTIVE</td>

								<td class="action-buttons">
									<a th:href="@{/admin/product/edit/{id}(id=${p.id})}" class="btn-icon btn-edit" title="Editar">
										<i class="fas fa-edit"></i>
									</a>
									<a th:href="@{/admin/product/delete/{id}(id=${p.id})}" class="btn-icon btn-delete" title="Excluir">
										<i class="fas fa-trash"></i>
									</a>
								</td>
							</tr>

							<tr th:if="${#lists.isEmpty(products)}">
								<td colspan="6">Nenhum produto cadastrado.</td>
							</tr>
						</tbody>
					</table>
				</div>
			</section>

			<!-- Usuários -->
			<section id="usuarios" class="admin-section">
				<div class="admin-header-section">
					<h2><i class="fas fa-users"></i> Gestão de Usuários</h2>
					<p style="opacity:.8">Em breve: lista dinâmica de usuários.</p>
				</div>
			</section>

			<!-- Pedidos -->
			<section id="pedidos" class="admin-section">
				<div class="admin-header-section">
					<h2><i class="fas fa-shopping-cart"></i> Gestão de Pedidos</h2>
					<p style="opacity:.8">Em breve: lista dinâmica de pedidos.</p>
				</div>
			</section>

		</main>
	</div>

	<script th:src="@{/js/main.js}"></script>
	<script th:src="@{/js/admin.js}"></script>

	<!-- Navegação do Sidebar + filtro select (client-side) -->
	<script>
		document.addEventListener('DOMContentLoaded', function () {
			// Sidebar navigation
			const links = document.querySelectorAll('.admin-nav-link');
			const sections = document.querySelectorAll('.admin-section');

			function showSection(sectionId) {
				sections.forEach(s => s.classList.remove('active'));
				links.forEach(l => l.classList.remove('active'));

				const target = document.getElementById(sectionId);
				if (target) target.classList.add('active');

				const activeLink = document.querySelector('.admin-nav-link[data-section="' + sectionId + '"]');
				if (activeLink) activeLink.classList.add('active');
			}

			links.forEach(link => {
				link.addEventListener('click', (e) => {
					e.preventDefault();
					const sectionId = link.dataset.section;
					if (sectionId) showSection(sectionId);
				});
			});

			// Categoria select filter (Tabela produtos)
			const select = document.getElementById('filter-categoria');
			if (select) {
				select.addEventListener('change', () => {
					const selected = (select.value || '').trim().toUpperCase();
					const rows = document.querySelectorAll('#produtos-table tbody tr[data-category]');

					rows.forEach(row => {
						const rowCat = (row.getAttribute('data-category') || '').trim().toUpperCase();
						const show = selected === '' || rowCat === selected;
						row.style.display = show ? '' : 'none';
					});
				});

				select.dispatchEvent(new Event('change'));
			}
		});
	</script>
</body>

</html>
